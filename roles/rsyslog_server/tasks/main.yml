---
- name: "Make logs mountpoint"
  ansible.builtin.file:
    path: "{{ rsyslog_server_mountpoint }}"
    state: directory
    owner: syslog
    group: adm
    mode: '0755'

- name: "Mount drive"
  ansible.posix.mount:
    src: "UUID={{ rsyslog_server_uuid }}"
    path: "{{ rsyslog_server_mountpoint }}"
    fstype: "{{ rsyslog_server_fstype }}"
    opts: "{{ rsyslog_server_options }}"
    state: mounted

- name: "Install rsyslog"
  ansible.builtin.apt:
    pkg: rsyslog
    cache_valid_time: "{{ all.vars.apt.cache_valid_time }}"
  notify: "Restart rsyslog"

- name: "Make Config directory"
  ansible.builtin.file:
    path: "/etc/rsyslog.d"
    state: directory
    owner: syslog
    group: adm
    mode: '0755'

- name: "Install rsyslog Config"
  ansible.builtin.template:
    src: "{{ item.src }}"
    dest: "{{ item.dest }}"
    owner: syslog
    group: adm
    mode: '0644'
  loop:
    - src: templates/etc/rsyslog.d/10-hayaworld.conf.j2
      dest: /etc/rsyslog.d/10-hayaworld.conf
    - src: templates/etc/rsyslog.conf.j2
      dest: /etc/rsyslog.conf
  notify: "Restart rsyslog"
