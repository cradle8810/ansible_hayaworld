---
- name: Install apcupsd for master
  ansible.builtin.include_tasks:
    file: roles/apcupsd/tasks/master.yml
  when: apcupsd_role == 'master'

- name: Install apcupsd for slave
  ansible.builtin.include_tasks:
    file: roles/apcupsd/tasks/slave.yml
  when: apcupsd_role == 'slave'

- name: Install apccontrol script
  ansible.builtin.template:
    src: templates/etc/apcupsd/apccontrol.j2
    dest: /etc/apcupsd/apccontrol
    owner: root
    group: root
    mode: '0755'

- name: "NFS / Set Restarting Rsyslog Service"
  community.general.ini_file:
    path: /usr/lib/systemd/system/rsyslog.service
    section: "Service"
    option: "{{ item.option }}"
    value: "{{ item.value }}"
    state: present
    no_extra_spaces: true
    mode: "644"
  notify:
    - "Restart rsyslog"
  loop:
    - option: "Restart"
      value: "always"
    - option: "RestartSec"
      value: "500"
